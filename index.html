<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É—Ä—Å –°—Ç–µ—Ä–≤—ã ‚Äî TMA</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:ital@0;1&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <style>
        :root {
            --bg-1: #000000; --bg-2: #1a001a; --bg-3: #2d001a;
            --accent-1: #ff0033; --accent-2: #cc0000; --accent-3: #990033;
            --text-main: #ffffff; --text-muted: #f0e6d6; --gold: #ffd700;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
            background: linear-gradient(180deg, var(--bg-1), var(--bg-3));
            color: var(--text-main);
            line-height: 1.4;
            min-height: 100vh;
            padding-bottom: 80px; /* Space for fixed button */
        }

        .tma-container {
            max-width: 100%;
            padding: 16px;
        }

        /* Header with Telegram-like back button */
        .tma-header {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .back-button {
            background: none;
            border: none;
            color: var(--text-main);
            font-size: 18px;
            padding: 8px;
            margin-right: 12px;
            cursor: pointer;
        }

        .tma-title {
            font-family: "UnifrakturCook", serif;
            font-size: 20px;
            color: var(--gold);
        }

        /* Hero section optimized for mobile */
        .tma-hero {
            text-align: center;
            padding: 20px 0;
            position: relative;
            background: radial-gradient(circle at top right, rgba(255, 0, 51, 0.1), transparent 50%);
        }

        .kicker {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 999px;
            background: linear-gradient(90deg, rgba(255, 0, 51, 0.2), rgba(204, 0, 0, 0.1));
            color: var(--gold);
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 12px;
            animation: flicker 3s ease-in-out infinite;
        }

        .hero-title {
            font-family: "UnifrakturCook", serif;
            font-size: 28px;
            margin-bottom: 12px;
            animation: glow 3s ease-in-out infinite;
        }

        .hero-subtitle {
            color: var(--text-muted);
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* Cards for mobile */
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: pulse-red 6s ease-in-out infinite;
        }

        .lesson-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lesson-card:active {
            transform: scale(0.98);
            background: rgba(255, 0, 51, 0.1);
        }

        .lesson-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, rgba(255, 0, 51, 0.15), rgba(153, 0, 51, 0.08));
            color: var(--gold);
            font-size: 16px;
        }

        .lesson-content {
            flex: 1;
        }

        .lesson-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .lesson-desc {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Fixed bottom button */
        .fixed-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
        }

        .tma-button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            animation: pulse-red 3s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tma-button:active {
            transform: scale(0.98);
        }

        /* Modal styles for TMA */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-content {
            background: linear-gradient(180deg, rgba(30, 0, 20, 0.95), rgba(10, 0, 10, 0.98));
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255, 0, 51, 0.3);
            animation: pulse-red 3s ease-in-out infinite;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-title {
            font-family: "UnifrakturCook", serif;
            color: var(--gold);
            font-size: 18px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 20px;
            cursor: pointer;
        }

        /* Form styles */
        .form-group {
            margin-bottom: 16px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.5);
            color: var(--text-main);
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-1);
        }

        /* Animations */
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 0, 51, 0.3); }
            50% { box-shadow: 0 0 30px rgba(255, 0, 51, 0.6), 0 0 50px rgba(255, 0, 51, 0.2); }
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 10px rgba(255, 0, 51, 0.5); }
            50% { text-shadow: 0 0 20px rgba(255, 0, 51, 0.8), 0 0 30px rgba(255, 0, 51, 0.4); }
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Utility classes */
        .section-title {
            font-family: "UnifrakturCook", serif;
            color: var(--gold);
            font-size: 18px;
            margin: 24px 0 16px 0;
            text-align: center;
            animation: glow 4s ease-in-out infinite;
        }

        .text-center { text-align: center; }
        .mb-16 { margin-bottom: 16px; }
        .mb-8 { margin-bottom: 8px; }

        /* Loading state */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Telegram Mini App Structure -->
    <div class="tma-container">
        <!-- Header -->
        <div class="tma-header">
            <button class="back-button" onclick="handleBack()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="tma-title">–ö—É—Ä—Å –°—Ç–µ—Ä–≤—ã</div>
        </div>

        <!-- Hero Section -->
        <section class="tma-hero">
            <div class="kicker">–¢–í–û–Å –ü–†–ï–û–ë–†–ê–ñ–ï–ù–ò–ï</div>
            <h1 class="hero-title">–•–≤–∞—Ç–∏—Ç –±—ã—Ç—å –ó–æ–ª—É—à–∫–æ–π</h1>
            <p class="hero-subtitle">
                –ü–æ—Ä–∞ —Å—Ç–∞—Ç—å –°—Ç–µ—Ä–≤–æ–π. –¢–≤–æ–π –ø—Ä–∏–Ω—Ü ‚Äî —ç—Ç–æ —Ç—ã. –ó–∞–±–µ—Ä–∏ —Å–≤–æ—é —Å–∏–ª—É, –¥–µ–Ω—å–≥–∏ –∏ –≤–ª–∞—Å—Ç—å –Ω–∞–¥ –∂–∏–∑–Ω—å—é.
            </p>
        </section>

        <!-- Problem Card -->
        <section class="mb-16">
            <div class="card">
                <h3 class="mb-8" style="color: var(--gold);">–ü—Ä–æ–∫–ª—è—Ç–∏–µ —Ä–æ–∑–æ–≤–æ–≥–æ –∫–æ—É—á–∏–Ω–≥–∞</h3>
                <p style="font-size: 14px; color: var(--text-muted);">
                    –•–≤–∞—Ç–∏—Ç —Å–ª—É—à–∞—Ç—å –ø—Ä–æ "–º—ã—Å–ª–∏ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ". –ü–æ—Ä–∞ –ó–ê–•–í–ê–¢–´–í–ê–¢–¨ –í–õ–ê–°–¢–¨. –≠—Ç–æ—Ç –∫—É—Ä—Å ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤–∑–ª–æ–º—É —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.
                </p>
            </div>
        </section>

        <!-- Program Section -->
        <section>
            <h2 class="section-title">8 –†–∏—Ç—É–∞–ª–æ–≤ –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è</h2>
            
            <div class="lesson-card" onclick="openLessonModal(1)">
                <div class="lesson-icon">
                    <i class="fas fa-skull"></i>
                </div>
                <div class="lesson-content">
                    <div class="lesson-title">–ü—Ä–æ–∫–ª—è—Ç–∏–µ –º–∏–ª–æ–π –¥–µ–≤–æ—á–∫–∏</div>
                    <div class="lesson-desc">–£–±–µ–π –≤ —Å–µ–±–µ —É–¥–æ–±–Ω—É—é –∫—É–∫–ª—É</div>
                </div>
            </div>

            <div class="lesson-card" onclick="openLessonModal(2)">
                <div class="lesson-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="lesson-content">
                    <div class="lesson-title">–ê–º—É–ª–µ—Ç ¬´–ù–µ –ø—Ä–æ–±—å–µ—à—å¬ª</div>
                    <div class="lesson-desc">–°—Ç–∞–ª—å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ç–∏–≤ —Ç–æ–∫—Å–∏—á–Ω—ã—Ö</div>
                </div>
            </div>

            <div class="lesson-card" onclick="openLessonModal(3)">
                <div class="lesson-icon">
                    <i class="fas fa-bullseye"></i>
                </div>
                <div class="lesson-content">
                    <div class="lesson-title">–¢–∞–ª–∏—Å–º–∞–Ω ¬´–•–æ—á—É –∏ –±—É–¥—É¬ª</div>
                    <div class="lesson-desc">–í–∑–ª–æ–º –º–æ–∑–≥–∞ –∫–∞–∫ —Ä–∞–¥–∞—Ä –Ω–∞ –¥–µ–Ω—å–≥–∏</div>
                </div>
            </div>

            <div class="lesson-card" onclick="openLessonModal(4)">
                <div class="lesson-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="lesson-content">
                    <div class="lesson-title">–ü—Ä–∏–≤–æ—Ä–æ—Ç –∫ —Å–µ–±–µ</div>
                    <div class="lesson-desc">–õ—é–±–æ–≤—å –∫ —Å–µ–±–µ –¥–æ –Ω–∞—Ä—Ü–∏—Å—Å–∏–∑–º–∞</div>
                </div>
            </div>

            <!-- Show more button -->
            <div class="text-center mb-16">
                <button onclick="showAllLessons()" style="
                    background: none;
                    border: 1px solid var(--accent-1);
                    color: var(--accent-1);
                    padding: 8px 16px;
                    border-radius: 8px;
                    font-size: 14px;
                ">
                    –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–Ω—è—Ç–∏—è
                </button>
            </div>
        </section>

        <!-- Results Section -->
        <section>
            <h2 class="section-title">–¢–≤–æ–∏ –ú–∞–≥–∏—á–µ—Å–∫–∏–µ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</h2>
            
            <div class="card mb-8">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                    <div class="lesson-icon">
                        <i class="fas fa-shield"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600;">–ê–º—É–ª–µ—Ç-–æ—Ö—Ä–∞–Ω–Ω–∏–∫</div>
                        <div style="font-size: 12px; color: var(--text-muted);">–ß—É–µ—à—å –ª–æ–∂—å –∑–∞ –≤–µ—Ä—Å—Ç—É</div>
                    </div>
                </div>
            </div>

            <div class="card mb-8">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                    <div class="lesson-icon">
                        <i class="fas fa-gem"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600;">–¢–∞–ª–∏—Å–º–∞–Ω-—Ü–µ–ª—å</div>
                        <div style="font-size: 12px; color: var(--text-muted);">–í–µ–¥—É—â–∏–π –∫ –¥–µ–Ω—å–≥–∞–º –º–∞–≥–Ω–∏—Ç</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Final CTA Card -->
        <section class="mb-16">
            <div class="card text-center">
                <h3 class="mb-8" style="color: var(--gold);">–•–≤–∞—Ç–∏—Ç –ø–æ–ª–∑–∞—Ç—å. –ü–æ—Ä–∞ –ª–µ—Ç–∞—Ç—å –Ω–∞ –º–µ—Ç–ª–µ.</h3>
                <p style="font-size: 14px; color: var(--text-muted); margin-bottom: 16px;">
                    –°—Ç–∞–Ω—å –•–æ–∑—è–π–∫–æ–π —Å–≤–æ–µ–π –°—É–¥—å–±—ã. –¢–æ–π, –∫–æ—Ç–æ—Ä—É—é –±–æ—è—Ç—Å—è –∏ –∫–æ—Ç–æ—Ä–æ–π —Ö–æ—Ç—è—Ç —Å—Ç–∞—Ç—å.
                </p>
                <button class="tma-button" onclick="openBookingModal()">
                    <i class="fas fa-fire"></i>
                    –ó–ê–ë–†–û–ù–ò–†–û–í–ê–¢–¨ –ú–ï–°–¢–û
                </button>
            </div>
        </section>
    </div>

    <!-- Fixed Bottom Button -->
    <div class="fixed-bottom">
        <button class="tma-button" onclick="openBookingModal()">
            <i class="fas fa-magic"></i>
            –ù–ê–ß–ê–¢–¨ –ü–†–ï–û–ë–†–ê–ñ–ï–ù–ò–ï
        </button>
    </div>

    <!-- Lesson Detail Modal -->
    <div class="modal-overlay" id="lessonModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="lessonModalTitle">–ó–∞–Ω—è—Ç–∏–µ</h3>
                <button class="modal-close" onclick="closeLessonModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="lessonModalContent">
                <!-- Content will be loaded here -->
            </div>
            <button class="tma-button" onclick="openBookingModal()" style="margin-top: 16px;">
                <i class="fas fa-fire"></i>
                –ó–ê–ë–†–û–ù–ò–†–û–í–ê–¢–¨
            </button>
        </div>
    </div>

    <!-- Booking Modal -->
    <div class="modal-overlay" id="bookingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–ë—Ä–æ–Ω—å –º–µ—Å—Ç–∞ –≤ –∞–¥—É</h3>
                <button class="modal-close" onclick="closeBookingModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="bookingForm" onsubmit="handleBooking(event)">
                <div class="form-group">
                    <input type="text" class="form-input" id="userName" 
                           placeholder="–¢–≤–æ—ë –∏–º—è" required>
                </div>
                <div class="form-group">
                    <input type="telegram" class="form-input" id="userTelegram" 
                           placeholder="Telegram –¥–ª—è —Å–≤—è–∑–∏" required>
                </div>                
                <button type="submit" class="tma-button" id="submitButton">
                    <i class="fas fa-hand-sparkles"></i>
                    –°–ö–†–ï–ü–ò–¢–¨ –î–û–ì–û–í–û–†
                </button>
            </form>
            
            <p style="font-size: 12px; color: var(--text-muted); text-align: center; margin-top: 12px;">
                –ù–∞–∂–∏–º–∞—è, —Ç—ã —Å–æ–≥–ª–∞—à–∞–µ—à—å—Å—è —Å —É—Å–ª–æ–≤–∏—è–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞ —Å –î—å—è–≤–æ–ª–æ–º (—Å–æ —Å–≤–æ–µ–π —Å–∏–ª–æ–π)
            </p>
        </div>
    </div>

    <script>
        // Telegram Web App initialization
        let tg = window.Telegram.WebApp;
        
        // Expand the app to full height
        tg.expand();
        
        // Set theme parameters
        tg.setHeaderColor('#000000');
        tg.setBackgroundColor('#000000');
        
        // User data from Telegram
        const user = tg.initDataUnsafe?.user;
        
        // Pre-fill form with Telegram user data if available
        if (user) {
            const userName = user.first_name || user.username || '';
            document.getElementById('userName').value = userName;
        }
        

        // Modal functions
        function openLessonModal(lessonNumber) {
            const lessons = {
                1: {
                    title: "–ü—Ä–æ–∫–ª—è—Ç–∏–µ –º–∏–ª–æ–π –¥–µ–≤–æ—á–∫–∏",
                    content: `<p>–¢—ã —É–±—å—ë—à—å –≤ —Å–µ–±–µ –∫—É–∫–ª—É, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É–¥–æ–±–Ω–æ–π, –∏ –≤—ã–ø—É—Å—Ç–∏—à—å –Ω–∞ —Å–≤–æ–±–æ–¥—É —Å–≤–æ—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –°—É—á–∫—É-–í–ª–∞–¥—ã—á–∏—Ü—É.</p>
                             <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –¢—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—à—å –±—ã—Ç—å "—É–¥–æ–±–Ω–æ–π" –∏ –Ω–∞—á–Ω—ë—à—å –±—ã—Ç—å "—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π".</p>`
                },
                2: {
                    title: "–ê–º—É–ª–µ—Ç ¬´–ù–µ –ø—Ä–æ–±—å–µ—à—å¬ª",
                    content: `<p>–¢—ã –æ—Ç–æ–ª—å—ë—à—å –∏–∑ —Å—Ç–∞–ª–∏ —Å–≤–æ–∏ –ª–∏—á–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã. –ù–∏ –æ–¥–∏–Ω –º—É–¥–∞–∫ –∏ –Ω–∏ –æ–¥–Ω–∞ —Ç–æ–∫—Å–∏—á–Ω–∞—è –º–∞–º–∞—à–∞ –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–æ–π–¥—É—Ç.</p>
                             <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –ó–∞—â–∏—Ç–∞ –æ—Ç —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏—Ö –≤–∞–º–ø–∏—Ä–æ–≤ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–æ–≤.</p>`
                },
                3: {
                    title: "–¢–∞–ª–∏—Å–º–∞–Ω ¬´–•–æ—á—É –∏ –±—É–¥—É¬ª", 
                    content: `<p>–¢—ã –≤–∑–ª–æ–º–∞–µ—à—å –º–æ–∑–≥ –∫–∞–∫ —Ä–∞–¥–∞—Ä –Ω–∞ –¥–µ–Ω—å–≥–∏. –¢–≤–æ—è —Ü–µ–ª—å –±—É–¥–µ—Ç –∫–∞–∫ –ø—Ä–æ–∫–ª—è—Ç–∏–µ ‚Äî –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–µ–±—è, –ø–æ–∫–∞ –Ω–µ —Å–¥–∞—à—å—Å—è.</p>
                             <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –î–µ–Ω—å–≥–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –ª–∏–ø–Ω—É—Ç—å –∫ —Ç–µ–±–µ –∫–∞–∫ –ø–æ –≤–æ–ª—à–µ–±—Å—Ç–≤—É.</p>`
                },
                4: {
                    title: "–ü—Ä–∏–≤–æ—Ä–æ—Ç –∫ —Å–µ–±–µ –ª—é–±–∏–º–æ–π",
                    content: `<p>–¢—ã –¥–æ–≤–µ–¥–µ—à—å –ª—é–±–æ–≤—å –∫ —Å–µ–±–µ –¥–æ –Ω–∞—Ä—Ü–∏—Å—Å–∏–∑–º–∞. –ö–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã —Å—Ç–∞–Ω—É—Ç –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏—è—Ç–Ω—ã–º —Ñ–æ–Ω–æ–º, –∞ –Ω–µ –∫–∏—Å–ª–æ—Ä–æ–¥–Ω–æ–π –º–∞—Å–∫–æ–π.</p>
                             <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –°–∞–º–æ–æ—Ü–µ–Ω–∫–∞, –∫–æ—Ç–æ—Ä—É—é –Ω–µ —Å–ª–æ–º–∏—Ç—å.</p>`
                }
            };
            
            const lesson = lessons[lessonNumber];
            if (lesson) {
                document.getElementById('lessonModalTitle').textContent = lesson.title;
                document.getElementById('lessonModalContent').innerHTML = lesson.content;
                document.getElementById('lessonModal').style.display = 'flex';
            }
        }

        function closeLessonModal() {
            document.getElementById('lessonModal').style.display = 'none';
        }

        function openBookingModal() {
            document.getElementById('bookingModal').style.display = 'flex';
        }

        function closeBookingModal() {
            document.getElementById('bookingModal').style.display = 'none';
        }

        function showAllLessons() {
            tg.showPopup({
                title: '–í—Å–µ 8 –∑–∞–Ω—è—Ç–∏–π',
                message: `1. –ü—Ä–æ–∫–ª—è—Ç–∏–µ –º–∏–ª–æ–π –¥–µ–≤–æ—á–∫–∏\n2. –ê–º—É–ª–µ—Ç ¬´–ù–µ –ø—Ä–æ–±—å–µ—à—å¬ª\n3. –¢–∞–ª–∏—Å–º–∞–Ω ¬´–•–æ—á—É –∏ –±—É–¥—É¬ª\n4. –ü—Ä–∏–≤–æ—Ä–æ—Ç –∫ —Å–µ–±–µ\n5. –û—Ç–≤–æ—Ä–æ—Ç –∏ –ø–æ—Ä—á–∞\n6. –ö–ª–∞–¥–±–∏—â–µ–Ω—Å–∫–∏–π —Ö–æ–¥\n7. –°–Ω—è—Ç–∏–µ –ø–æ—Ä—á–∏\n8. –ú–∞–Ω–∏—Ñ–µ—Å—Ç –í–µ–¥—å–º—ã`,
                buttons: [{ type: 'ok' }]
            });
        }

        // Handle form submission
            async function handleBooking(event) {
                event.preventDefault();
                
                const submitButton = document.getElementById('submitButton');
                const originalText = submitButton.innerHTML;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';
                submitButton.disabled = true;

                const userName = document.getElementById('userName').value || '–ë–µ–∑ –∏–º–µ–Ω–∏';
                const userTelegram = document.getElementById('userTelegram').value || '–ù–µ —É–∫–∞–∑–∞–Ω';

                try {
                    await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent("https://script.google.com/macros/s/AKfycbzjsQNpzEwFF-z5-3IGkFHt9hdzr6zgjvAAJlsb879_DVPot0BH-TpWCZo9IjgkcEGliA/exec"), {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ name: userName, telegram: userTelegram }),
                    });

                    tg.showPopup({
                        title: "–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ üî•",
                        message: `${userName}, —Ç—ã –ø—Ä–∏–Ω—è—Ç–∞!`,
                        buttons: [{ type: "ok" }],
                    });

                    closeBookingModal();
                } catch (err) {
                    tg.showPopup({
                        title: "–û—à–∏–±–∫–∞ üòø",
                        message: "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.",
                        buttons: [{ type: "ok" }],
                    });
                } finally {
                    submitButton.innerHTML = originalText;
                    submitButton.disabled = false;
                }
            }


        // Telegram back button handler
        function handleBack() {
            if (document.getElementById('lessonModal').style.display === 'flex') {
                closeLessonModal();
            } else if (document.getElementById('bookingModal').style.display === 'flex') {
                closeBookingModal();
            } else {
                tg.close();
            }
        }

        // Share function
        function shareApp() {
            if (tg.showShareAlert) {
                tg.showShareAlert({
                    title: '–ö—É—Ä—Å –°—Ç–µ—Ä–≤—ã - –°—Ç–∞–Ω—å –•–æ–∑—è–π–∫–æ–π –°—É–¥—å–±—ã',
                    text: '–•–≤–∞—Ç–∏—Ç –±—ã—Ç—å –ó–æ–ª—É—à–∫–æ–π. –ü–æ—Ä–∞ —Å—Ç–∞—Ç—å –°—Ç–µ—Ä–≤–æ–π. –¢–≤–æ–π –ø—Ä–∏–Ω—Ü ‚Äî —ç—Ç–æ —Ç—ã.',
                    url: window.location.href
                });
            }
        }

        // Add share button to header if supported
        if (tg.isVersionAtLeast('6.2')) {
            const header = document.querySelector('.tma-header');
            const shareBtn = document.createElement('button');
            shareBtn.innerHTML = '<i class="fas fa-share-alt"></i>';
            shareBtn.style.background = 'none';
            shareBtn.style.border = 'none';
            shareBtn.style.color = 'var(--text-main)';
            shareBtn.style.marginLeft = 'auto';
            shareBtn.style.padding = '8px';
            shareBtn.onclick = shareApp;
            header.appendChild(shareBtn);
        }

        // Handle theme changes
        tg.onEvent('themeChanged', () => {
            const theme = tg.colorScheme;
            if (theme === 'dark') {
                document.body.style.background = 'linear-gradient(180deg, var(--bg-1), var(--bg-3))';
            } else {
                document.body.style.background = 'linear-gradient(180deg, #2d001a, #1a001a)';
            }
        });

        // Ready to show app
        tg.ready();
    </script>
</body>
</html>